<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶¨‡¶æ‡ßü‡ßá‡¶ï ‡¶Ü‡¶≤‡¶π‡¶æ‡¶ú‡ßç‡¶¨ ‡¶∂‡¶æ‡¶π ‡¶Ü‡¶≤‡¶Æ ‡¶ï‡¶≤‡ßá‡¶ú ‡¶¨‡ßç‡¶≤‡¶æ‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï ‡¶∏‡ßã‡¶∏‡¶æ‡¶á‡¶ü‡¶ø</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
</head>
<body class="bg-gray-100 text-gray-900 font-sans transition-colors duration-500">

<!-- Header -->
<header class="bg-red-600 text-white text-center py-6 shadow-lg">
  <h1 class="text-3xl font-bold">‡¶¨‡¶æ‡ßü‡ßá‡¶ï ‡¶Ü‡¶≤‡¶π‡¶æ‡¶ú‡ßç‡¶¨ ‡¶∂‡¶æ‡¶π ‡¶Ü‡¶≤‡¶Æ ‡¶ï‡¶≤‡ßá‡¶ú ‡¶¨‡ßç‡¶≤‡¶æ‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï ‡¶∏‡ßã‡¶∏‡¶æ‡¶á‡¶ü‡¶ø</h1>
  <p class="text-lg">‡¶ú‡¶∞‡ßÅ‡¶∞‡ßÄ ‡¶∏‡¶Æ‡ßü‡ßá ‡¶∞‡¶ï‡ßç‡¶§ ‚Äì ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶¨‡¶æ‡¶Å‡¶ö‡¶æ‡¶§‡ßá ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶õ‡¶ø</p>
</header>

<!-- Hero Section -->
<section class="text-center py-12">
  <img src="logo.png" alt="Logo" class="mx-auto w-32 mb-6 rounded-full shadow-lg">
  <h2 class="text-2xl font-semibold mb-4">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ Android ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
  <div class="flex justify-center gap-4">
    <a href="blooddonor.apk" download class="px-6 py-3 bg-red-600 text-white text-lg rounded-xl shadow hover:bg-red-700">üì• Download APK</a>
    <button id="qrBtn" class="px-6 py-3 bg-gray-800 text-white text-lg rounded-xl shadow hover:bg-gray-900">üì± QR Code</button>
  </div>
  <div id="qrCode" class="mt-4"></div>
</section>

<!-- Search & Filter -->
<section class="max-w-6xl mx-auto py-6 px-6">
  <div class="flex flex-col md:flex-row gap-4 md:justify-between mb-4">
    <input id="searchInput" type="text" placeholder="‡¶®‡¶æ‡¶Æ, ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..." class="px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 w-full md:w-1/2">
    <select id="groupFilter" class="px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-red-500 w-full md:w-1/4">
      <option value="">‡¶∏‡¶¨ ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</option>
      <option value="A Positive">A Positive</option>
      <option value="B Positive">B Positive</option>
      <option value="O Positive">O Positive</option>
      <option value="AB Positive">AB Positive</option>
    </select>
  </div>
</section>

<!-- Donor Summary -->
<section class="max-w-6xl mx-auto py-4 px-6">
  <div id="donorSummary" class="flex flex-wrap gap-4 justify-center"></div>
</section>

<!-- Donor Table Section -->
<section class="max-w-6xl mx-auto py-12 px-6">
  <h2 class="text-2xl font-bold text-center mb-6 text-red-600">ü©∏ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶§‡¶æ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>

  <!-- Table -->
  <div class="overflow-x-auto shadow-lg rounded-xl hidden md:block">
    <table class="w-full text-sm text-left border-collapse bg-white">
      <thead class="bg-red-600 text-white">
        <tr>
          <th class="px-4 py-3">‡¶®‡¶æ‡¶Æ</th>
          <th class="px-4 py-3">‡¶ó‡ßç‡¶∞‡ßÅ‡¶™</th>
          <th class="px-4 py-3">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤</th>
          <th class="px-4 py-3">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</th>
          <th class="px-4 py-3">‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®</th>
          <th class="px-4 py-3">‡¶Æ‡ßã‡¶ü ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®</th>
          <th class="px-4 py-3">‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
        </tr>
      </thead>
      <tbody id="donorTable" class="divide-y divide-gray-200">
        <tr><td colspan="7" class="text-center py-4">‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</td></tr>
      </tbody>
    </table>
  </div>

  <!-- Card view for mobile -->
  <div id="donorCards" class="grid grid-cols-1 md:hidden gap-4"></div>
</section>

<!-- Analytics Section -->
<section class="max-w-4xl mx-auto py-12 px-6">
  <h2 class="text-xl md:text-2xl font-bold text-center mb-6 text-red-600">üìä ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™ ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£</h2>
  <canvas id="bloodChart" class="mx-auto" style="max-height:300px;"></canvas>
</section>

<!-- Footer -->
<footer class="bg-red-600 text-white text-center py-4 mt-12">
  <p>¬© 2025 ‡¶¨‡¶æ‡ßü‡ßá‡¶ï ‡¶Ü‡¶≤‡¶π‡¶æ‡¶ú‡ßç‡¶¨ ‡¶∂‡¶æ‡¶π ‡¶Ü‡¶≤‡¶Æ ‡¶ï‡¶≤‡ßá‡¶ú ‡¶¨‡ßç‡¶≤‡¶æ‡¶° ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï ‡¶∏‡ßã‡¶∏‡¶æ‡¶á‡¶ü‡¶ø</p>
</footer>

<script>
const donorTable = document.getElementById("donorTable");
const donorCards = document.getElementById("donorCards");
const searchInput = document.getElementById("searchInput");
const groupFilter = document.getElementById("groupFilter");
let donorsData = {};
const firebaseURL = "https://basc-blood-bank-default-rtdb.firebaseio.com/Users.json";

// Fetch Data
fetch(firebaseURL)
.then(res=>res.json())
.then(data=>{
  donorsData = data;
  render();
  renderChart();
  renderSummary();
})
.catch(err=>console.error(err));

// QR Code
document.getElementById("qrBtn").addEventListener("click", ()=>{
  const qr = new QRious({element: document.createElement('canvas'), value: "https://bloodbank.com/download"});
  const qrDiv = document.getElementById("qrCode");
  qrDiv.innerHTML=""; qrDiv.appendChild(qr.element);
});

// Badges for total donations
function getBadge(total){
  if(total>=20) return "üéñÔ∏è";
  if(total>=15) return "ü•á";
  if(total>=10) return "üèÜ";
  if(total>=5) return "üèÖ";
  return "";
}

// Render summary
function renderSummary(){
  const summaryDiv = document.getElementById("donorSummary");
  const counts = {};
  Object.values(donorsData).forEach(d=>{
    counts[d.type] = (counts[d.type]||0)+1;
  });
  
  summaryDiv.innerHTML = "";
  const colors = {
    "A Positive": "bg-red-500",
    "B Positive": "bg-blue-500",
    "O Positive": "bg-green-500",
    "AB Positive": "bg-pink-400"
  };
  
  Object.keys(counts).forEach(type=>{
    const count = counts[type];
    const colorClass = colors[type] || "bg-gray-400";
    summaryDiv.innerHTML += `
      <div class="px-4 py-2 rounded-xl text-white font-semibold ${colorClass}">
        ${type}: ${count} ‡¶ú‡¶®
      </div>
    `;
  });
}

// Render Table & Cards
function render(){
  const searchText = searchInput.value.toLowerCase();
  const groupText = groupFilter.value;
  const today = new Date();
  const filtered = Object.values(donorsData).filter(d =>
    d.name.toLowerCase().includes(searchText) &&
    (groupText==="" || d.type===groupText)
  );

  // Table
  donorTable.innerHTML="";
  if(filtered.length===0) donorTable.innerHTML='<tr><td colspan="7" class="text-center py-4">‡¶ï‡ßã‡¶®‡¶ì ‡¶°‡ßã‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</td></tr>';
  else filtered.forEach(d=>{
    const lastDonateDate = new Date(d.lastDonate);
    const isRecent = (today-lastDonateDate)/(1000*60*60*24)<=30;
    donorTable.innerHTML+=`
      <tr class="hover:bg-gray-100 ${isRecent?'bg-yellow-50':''}">
        <td class="px-4 py-2 font-medium">${d.name}</td>
        <td class="px-4 py-2 font-bold text-red-600">${d.type}</td>
        <td class="px-4 py-2"><a href="tel:${d.mobile}" class="text-blue-600 underline">${d.mobile}</a></td>
        <td class="px-4 py-2">${d.address}</td>
        <td class="px-4 py-2">${d.lastDonate}</td>
        <td class="px-4 py-2">${d.total} ${getBadge(d.total)}</td>
        <td class="px-4 py-2"><span class="px-2 py-1 rounded text-white ${d.status==="Active"?"bg-green-500":"bg-gray-500"}">${d.status}</span></td>
      </tr>`;
  });

  // Cards
  donorCards.innerHTML="";
  if(filtered.length===0) donorCards.innerHTML='<p class="text-center py-4">‡¶ï‡ßã‡¶®‡¶ì ‡¶°‡ßã‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>';
  else filtered.forEach(d=>{
    const lastDonateDate = new Date(d.lastDonate);
    const isRecent = (today-lastDonateDate)/(1000*60*60*24)<=30;
    donorCards.innerHTML+=`
      <div class="bg-white shadow p-4 rounded-xl border-l-4 ${d.status==="Active"?"border-green-500":"border-gray-500"} ${isRecent?'bg-yellow-50':''}">
        <h3 class="text-lg font-bold mb-1">${d.name}</h3>
        <p><span class="font-semibold">‡¶ó‡ßç‡¶∞‡ßÅ‡¶™:</span> ${d.type}</p>
        <p><span class="font-semibold">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤:</span> <a href="tel:${d.mobile}" class="text-blue-600 underline">${d.mobile}</a></p>
        <p><span class="font-semibold">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ:</span> ${d.address}</p>
        <p><span class="font-semibold">‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®:</span> ${d.lastDonate}</p>
        <p><span class="font-semibold">‡¶Æ‡ßã‡¶ü ‡¶∞‡¶ï‡ßç‡¶§‡¶¶‡¶æ‡¶®:</span> ${d.total} ${getBadge(d.total)}</p>
        <p><span class="font-semibold">‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏:</span> <span class="px-2 py-1 rounded text-white ${d.status==="Active"?"bg-green-500":"bg-gray-500"}">${d.status}</span></p>
      </div>`;
  });
}

// Render Chart
function renderChart(){
  const counts={};
  Object.values(donorsData).forEach(d=>{ counts[d.type]= (counts[d.type]||0)+1; });
  const ctx = document.getElementById("bloodChart").getContext("2d");
  new Chart(ctx,{
    type:'pie',
    data:{
      labels:Object.keys(counts).map(type=>`${type} (${counts[type]})`),
      datasets:[{data:Object.values(counts), backgroundColor:['#f87171','#60a5fa','#34d399','#f9a8d4']}]
    },
    options:{responsive:true, plugins:{legend:{position:'bottom'}}}
  });
}

searchInput.addEventListener("input", render);
groupFilter.addEventListener("change", render);
</script>
</body>
</html>
